<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Search for up to 200 places with Radar Search</title>

    <link rel="stylesheet" href="css/estilos.min.css">
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100%;
      }
    </style>
    <script>
// This example requires the Places library. Include the libraries=places
// parameter when you first load the API. For example:
// <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

window.onload = function() {

};

var map;
var infoWindow;
var infoBubble;
var service;

function initMap() {
  var startPos;
  var geoOptions = {
    enableHighAccuracy: true
  }

  var geoSuccess = function(position) {

    var mapOptions = {
        // How zoomed in you want the map to start at (always required)
        zoom: 11,

        // The latitude and longitude to center the map (always required)
        center: new google.maps.LatLng(40.6700, -73.9400), // New York

        // How you would like to style the map.
        // This is where you would paste any style found on Snazzy Maps.
        styles: [{"featureType":"all","elementType":"labels.text.fill","stylers":[{"saturation":36},{"color":"#000000"},{"lightness":40}]},{"featureType":"all","elementType":"labels.text.stroke","stylers":[{"visibility":"on"},{"color":"#000000"},{"lightness":16}]},{"featureType":"all","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"administrative","elementType":"geometry.fill","stylers":[{"color":"#000000"},{"lightness":20}]},{"featureType":"administrative","elementType":"geometry.stroke","stylers":[{"color":"#000000"},{"lightness":17},{"weight":1.2}]},{"featureType":"landscape","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":20}]},{"featureType":"poi","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":21}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#000000"},{"lightness":17}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#000000"},{"lightness":29},{"weight":0.2}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":18}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":16}]},{"featureType":"transit","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":19}]},{"featureType":"water","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":17}]}]
  };

    startPos = position;
    //document.getElementById('startLat').innerHTML = startPos.coords.latitude;
    //document.getElementById('startLon').innerHTML = startPos.coords.longitude;
    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: startPos.coords.latitude , lng: startPos.coords.longitude},
      zoom: 15,
      styles: [{
        stylers: [{ visibility: 'simplified' }]
      }, {
        elementType: 'labels',
        stylers: [{ visibility: 'off' }]
      }]
    });

  infoWindow = new google.maps.InfoWindow();
  infoBubble = new InfoBubble({
     map: map,
     content: '<div class="mylabel">The label</div>',
     position:  place.geometry.location,
     shadowStyle: 1,
     padding: 0,
     backgroundColor: 'rgb(57,57,57)',
     borderRadius: 5,
     arrowSize: 10,
     borderWidth: 1,
     borderColor: '#2c2c2c',
     disableAutoPan: true,
     hideCloseButton: true,
     arrowPosition: 30,
     backgroundClassName: 'transparent',
     arrowStyle: 2
   });
    service = new google.maps.places.PlacesService(map);
    map.addListener('idle', performSearch);

  };
  var geoError = function(error) {
    console.log('Error occurred. Error code: ' + error.code);
    // error.code can be:
    //   0: unknown error
    //   1: permission denied
    //   2: position unavailable (error response from location provider)
    //   3: timed out
  };

  navigator.geolocation.getCurrentPosition(geoSuccess, geoError, geoOptions);





  // The idle event is a debounced event, so we can query & listen without
  // throwing too many requests at the server.
//
}

function performSearch() {
  var request = {
    bounds: map.getBounds(),
    keyword: 'hamburgueseria'
  };
  service.radarSearch(request, callback);
}

function callback(results, status) {
  if (status !== google.maps.places.PlacesServiceStatus.OK) {
    console.error(status);
    return;
  }
  for (var i = 0, result; result = results[i]; i++) {
    addMarker(result);
  }
}

function addMarker(place) {
  var marker = new google.maps.Marker({
    map: map,
    position: place.geometry.location,
    icon: {
      url: 'https://s3.amazonaws.com/com.cartodb.users-assets.production/production/0xbunny/assets/20150929061600pinfinal.png',
      anchor: new google.maps.Point(10, 10),
      scaledSize: new google.maps.Size(24, 30)
    }
  });

  google.maps.event.addListener(marker, 'click', function() {
    service.getDetails(place, function(result, status) {
      if (status !== google.maps.places.PlacesServiceStatus.OK) {
        console.error(status);
        return;
      }
      //infoWindow.setContent(result.name);
    //  infoWindow.open(map, marker);
      infoBubble.setContent(result.name);
      infoBubble.open(map, marker);

    });
  });
}

    </script>
  </head>
  <body>
<div id="header"></div>
    <div id="map"></div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQfcDN9E0XZQcuYDEV4WaYK0J_4Q63mi4&signed_in=true&libraries=places&callback=initMap" async defer></script>


    <script type="text/javascript" src="js/infoBubble.js">    </script>

  </body>
</html>
